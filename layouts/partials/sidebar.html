{{ $sidebar := .Params.sidebar }}
{{ $custom_sidebar := .Params.customnav }}
{{ $guides := ( where .Site.Pages "Params.kind" "==" "guide" ) }}
{{ $integrations := ( where .Site.Pages "Params.kind" "==" "integration" ) }}
{{ $currentURL := .URL }}
{{ $lastUrlElement := index (last 1 (split (delimit (split .URL "/") "," "") ",")) 0 }}

<ul class="nav nav-tabs nav-stacked sidebar">

  <!-- search -->
  {{ if ne .Site.Language.Lang "ja"}}
    <li class="nav-header">Documentation Search</li>
    <li>
      <form action="{{ $.Site.BaseURL }}search/">
      <input type="text" name="q" id="tipue_search_input" autocomplete="off" required>
      </form>
    </li>
  {{ end }}

{{ if $custom_sidebar }}
{{ $nav_headers := (slice "customnav_tracingnav_tracing" "customnav_tracingnav_langs")}}
  <li id="toc-box"></li>
  {{ range .Site.Menus.tracingnav -}}

    {{ if in $nav_headers .Identifier }}
    <li class="nav-header">{{ i18n .Identifier }}</li>
    {{ else }}

    <li class="">
      <a href="{{ .URL | absLangURL }}">{{ i18n .Identifier }}</a>
    </li>
    {{ end }}

  {{ end }}

{{ else }}

  <!-- table of contents -->
  {{ if $.Params.sidebar.nav }}
    <li class='nav-header'>Table of Contents</li>
    {{ range $k, $v := $.Params.sidebar.nav }}

      {{ if not $v.header }}

        <li><a href="{{ $v.href | absLangURL }}">{{ $v.text }}</a></li>

      {{ end }}

    {{ end }}
  {{ else if len .Data.Pages }}
    {{ if in .Kind "taxonomy" }}
    {{ else }}
    <li class='nav-header'>Table of Contents</li>
    <li class='nav-header'>{{ i18n "table_of_contents" }}</li>
      {{ range (sort .Data.Pages "BaseFileName") }}
        <li><a href="{{ .Permalink }}">{{ .Title }}</a></li>
      {{ end }}
    {{ end }}
  {{ end }}

  {{ if in .File.Path "basic_agent_usage" }}

    <li class="nav-header">Agent Guides by Platform</li>

    {{ range .Site.Menus.basic_agent.ByWeight }}

      <li><a href="{{ .URL | absLangURL }}">{{ i18n .Identifier }}</a>

    {{ end }}

  {{ else }}
    <li id="toc-box"></li>
    {{ if eq .Params.Kind "integration" }}
      <li class="nav-header">{{ i18n "integrations_other_integrations" }}</li>
      <li class="integration"><a href="/integrations/">{{ i18n "integrations_back_to_overview" }}</a></li>
      {{ range $integrations }}
          <li class="integration"><a href="{{.Permalink}}">
            {{ if eq $lastUrlElement .File.TranslationBaseName }}&gt;{{ end }}
            {{ .Params.integration_title }}
          </a></li>
      {{ end }}
    {{ else }}
      {{ if $guides }}
        <li class="nav-header">{{ i18n "menu_guides" }}</li>
      {{ else }}
        <li class='nav-header'>Table of Contents</li>
      {{ end }}

      {{ range sort $guides "Params.listorder" "asc" }}

        {{ if (and ( isset .Params "listorder" ) ( ne .Params.beta true )) }}
            <li><a href="{{.Permalink}}">{{ .Title }}</a></li>
        {{ end }}

      {{ end }}
    {{ end }}

  {{ end }}

{{ end }}
</ul>
